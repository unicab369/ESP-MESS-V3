<!DOCTYPE html>
<html>
<head>
    <title>ESP32 uPlot Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="lib/uplot/dist/uPlot.min.css">
    <link rel="stylesheet" href="plots-style.css">
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>ðŸ“ˆ ESP32 uPlot Dashboard</h1>
            <p>Real-time sensor data visualization</p>
            
            <div class="status-bar">
                <div class="status-item">
                    <div>ESP32 IP</div>
                    <div id="espIp">Connecting...</div>
                </div>
                <div class="status-item">
                    <div>Free Memory</div>
                    <div id="freeMemory">---</div>
                </div>
                <div class="status-item">
                    <div>Chart Points</div>
                    <div id="pointCount">0</div>
                </div>
                <div class="status-item">
                    <div>Update Rate</div>
                    <div><span id="updateRate">1</span> sec</div>
                </div>
            </div>
            
            <div class="input-group">
                <input type="text" id="serverIp" placeholder="ESP32 IP Address" value="10.0.0.188">
                <button class="btn" onclick="connectToServer()">Connect</button>
                <button class="btn" onclick="startLiveData()">Start Live</button>
                <button class="btn" onclick="stopLiveData()">Stop</button>
                <button class="btn" onclick="clearCharts()">Clear</button>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="updateRate(0.5)">Fast (0.5s)</button>
                <button class="btn" onclick="updateRate(1)">Normal (1s)</button>
                <button class="btn" onclick="updateRate(2)">Slow (2s)</button>
                <button class="btn" onclick="updateRate(5)">Very Slow (5s)</button>
            </div>
        </div>
        
        <div class="charts-container">
            <div class="chart-card">
                <div class="chart-title">ðŸ“Š Real-time Sensor Data</div>
                <div class="chart-wrapper">
                    <div id="sensorChart"></div>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-title">ðŸ“ˆ Historical Data</div>
                <div class="chart-wrapper">
                    <div id="historyChart"></div>
                </div>
            </div>
        </div>
        
        <div class="chart-card">
            <div class="chart-title">ðŸ“‹ Live Data Feed</div>
            <pre id="liveData">Waiting for data...</pre>
        </div>
    </div>
    
    <!-- uPlot JavaScript -->
    <script src="lib/uplot/dist/uPlot.iife.min.js"></script>
    <script src="plots-script.js"></script>
    
    <script>        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (sensorChart) {
                sensorChart.setSize({
                    width: document.getElementById('sensorChart').parentElement.offsetWidth,
                    height: 280
                });
            }
            if (historyChart) {
                historyChart.setSize({
                    width: document.getElementById('historyChart').parentElement.offsetWidth,
                    height: 280
                });
            }
        });
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            initCharts();
            
            // Auto-connect if IP is set
            const ipInput = document.getElementById('serverIp');
            if (ipInput.value) {
                setTimeout(connectToServer, 1000);
            }
        });
    </script>
</body>
</html>